// Node v12.22.9
const INPUT = `.....................#......#...................#...............#........................................#..................................
...........................................................#.............................................................#..................
.....................................................................#.........#......#...........#.............#...........................
.....................................................#.......................................#..............................................
......#.................................#..........................................................................................#........
....................#.........#.............................................................................#...............................
..#.........................................................#.............................................................................#.
........................................................................................#...........#..................#....................
........#....................................#........................#.........................................................#...........
..............................................................................#................................#............................
..................................................#............#............................................................................
.........................#......#........#................................................#..........................................#......
......#..............................................................................#...............#......................................
...................................................................#........................................................................
....................#...........................#............................................................#..............#.....#.........
..................................#....................#.........................................#......#..............................#....
.#..........................................................................................................................................
........#.....#........................#...........#.............#.....................#....................................................
..........................#.................................#.....................#.........................................................
.............................................................................................................................#.............#
...................................#......................................................#....................#............................
.....................#...................#............#..................#.............................................#...........#........
..............................................................................................#.............................................
....#..........#...............#..........................................................................#.................................
.............................................#..............................................................................................
...................................................................#..............#.................................#.......................
..................#........................................................#................................................................
..#.................................#...................#..............................#.........................................#.......#..
...............................................................#...............#.....................#..........#.........#.................
.........#......................#.............................................................#.............................................
..............#...............................#.............................................................................................
........................................#.................................#............................................................#....
..............................................................................................................#......#......#...............
.........................#..........#.............................................#........#................................................
....................................................................#.....................................#.................................
....#...............#........#...............................#........................#........................................#............
........................................................#...................................................................................
............................................#...........................#......................#.....#......................................
.........................................................................................#.............................................#....
...........#....................#..................................#.................................................#...........#..........
.#..........................................................................................................................................
................#........................#..........#.......................................................................................
........................#........................................................................................#..........................
........................................................................#.........#...................#...................#.................
........................................................#......................................................................#............
.....#.....................................................................................#................................................
...............#...................................#.................#..............................................................#.......
.........#..................#..................................#..................................................#.........................
......................................#.......#....................................#......................................................#.
..........................................................................................................#......................#..........
...#..............#.......................#.....................................................#...........................................
................................#...............................................#..........#................................................
..........................#......................#......................#...................................................................
..................................................................#................................#........................................
......................................................#.................................#.........................#...................#.....
..............#..........................#..................................................................................#...............
......#......................#.................................................................#...........#................................
.............................................................................#..............................................................
.......................#..........................#......................................................................#..........#.......
.#.................................#................................................................#....................................#..
........#......#................................................#...............................................#...........................
..........................................................................#.....#.........................#...........#.....#...............
............................#..............#..........#....................................#................................................
............................................................................................................................................
............#..........#....................................................................................................................
............................................................#.......................#..............#........................................
.....................................#...............................#...................................#..................................
.........#.....................................................................#.....................................#...............#.....#
#.............#.............................................................................................................................
......................................................#....................................#....................................#...........
...................................................................#............................................#...........................
............................................................................................................................................
....................#............................#................................................#......................................#..
.............................#...................................................#..........................................................
.........................................................................#...............#.................#................................
.............#.........#.........#.....#......................#............................................................#................
............................................................................................................................................
.............................................#..........#.....................#..................................#..........................
............................................................................................................................................
...................................#.............#................#.....#.....................................................#.............
....#.....................#..................................#..............................................................................
............................................................................................................................................
#.....................................#...................................................................................#.................
...............................................#......................#.....#...................................#...........................
.........#...................#.....................................................#.................#......................................
.......................#...............................#........................................#..............................#............
...#.....................................#..................................................................#...............................
...................................................#......................................#...........................................#.....
.................#..........................................................................................................................
...................................................................................................................#......#.................
.................................#..............#.....#......................#.................#.........#..................................
#....................................................................#........................................#...........................#.
............................................................................................................................................
.........................#..................................................................................................................
...............................#.......................................................................................#....................
..........#...................................#..................#.....................#....................#...............................
............................................................................#.....#.........................................................
....#............#............................................................................#.......#..........#..........................
..................................................................................................................................#.........
...................................#...........................................#............................................................
.............................#..........................#.................................#........#........................................
..............#....................................................#........................................#.............#...........#.....
...............................................#.............#.......................................................#......................
........#..............................................................#....................................................................
.......................................................................................#........#...........................................
......................#........#.........................#..................#........................#......................#...............
.#.........#.....#..............................................#........................................................................#..
.....................................................#......................................................................................
.........................................#...........................#..............................................#.......................
.............................................................#................................................#................#............
......#.......................................#.......................................#...............#.....................................
....................#.......#............................#................#...........................................................#.....
...........#.....................................................................................................#..........................
..........................................................................................#..............#..................................
..................................................#..........................................................................#..............
...............#............................................#.....................................................................#.........
........................#...........................................#............................#..................#.......................
................................................................................#..............................#.......................#....
......................................#...................................#..............#..............#...................................
..#............................................#..............#...........................................................#.................
.........#........................#...................#.....................................................................................
.............................#..............................................................................................................
....................................................................................#.......................................................
.........................#.............#............................................................#......#......#.........#......#........
...................#...........................................................................#...........................................#
.......#...............................................#.....#........#..........#..........................................................
..............#....................#........................................................................................................
........................................................................................................#.................#...........#.....
..#...............................................................#.........#.......#.......................................................
.........#......................#..........................#.....................................#............#.............................
...................#.................................#.................................................................#....................
....................................#.......................................................................................................
...........................#......................................................................................................#.........
............................................#.................#............#...................#.......#...................#................
............#.....................................#.........................................................................................
...........................................................................................................#......#.........................
.....................................#..............................................#......#................................................
.........................................................................#..............................................#...................
#....................#........#...................................................................#.....................................#...
.....#........................................#.........#........................#..........................................................`

function mark_expansions(input) {
    const lines = input.split(/\r?\n|\r|\n/g);
    console.log("Original dimensions: " + lines.length + " X " + lines[0].split('').length);

    let matrix = [];
    for (const [_, l] of lines.entries()) {
        if (l.match(/#/g)) {
            matrix.push(l.split(''));
        } else {
            let expansion_marker = []
            for (let i = 0; i < l.length; i++) {
                expansion_marker.push('E');
            }
            matrix.push(expansion_marker);
        }
    }
    let transposed = matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));

    matrix = [];
    for (let i = 0; i < transposed.length; i++) {
        const l = transposed[i].join('');
        if (l.match(/#/g)) {
            matrix.push(l.split(''));
        } else {
            let expansion_marker = []
            for (let i = 0; i < l.length; i++) {
                expansion_marker.push('E');
            }
            matrix.push(expansion_marker);
        }
    }

    transposed =  matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));
    console.log("Expanded dimensions: " + transposed.length + " X " + transposed[0].length);
    return transposed;
}

console.log(INPUT);
expanded = mark_expansions(INPUT)
for (const [_, e] of expanded.entries()) {
    console.log(e.join(''));
}

expansionsX = [];
for (const [x, e] of expanded.entries()) {
    const l = e.join('');
    if (!l.match(/(\.|#)/g)) {
        expansionsX.push(x);
    }
}
console.log("X (lines) with expansion: " + expansionsX);

expansionsY = [];
const transposed =  expanded[0].map((_, colIndex) => expanded.map(row => row[colIndex]));
for (const [y, e] of transposed.entries()) {
    const l = e.join('');
    if (!l.match(/(\.|#)/g)) {
        expansionsY.push(y);
    }
}
console.log("Y (columns) with expansion: " + expansionsY);

let galaxies = [];
for (const [x, _] of expanded.entries()) {
    for (const [y, e] of expanded[x].entries()) {
        if (e == "#") {
            galaxies.push([x, y]);
        }
    }
}
console.log("N galaxies: " + galaxies.length);

function calculate(expansion_factor) {
    let sum = 0;
    let nPairs = 0;
    for (const [i, g1] of galaxies.entries()) {
        for (let j = i + 1; j < galaxies.length; j++) {
            const g2 = galaxies[j];

            let maxX = Math.max(g1[0], g2[0]);
            const minX = Math.min(g1[0], g2[0]);

            let xIncrement = 0;
            for (const [_, eX] of expansionsX.entries()) {
                if (minX < eX && eX < maxX) {
                    xIncrement += expansion_factor;
                }
            }
            maxX += xIncrement;

            let maxY = Math.max(g1[1], g2[1]);
            const minY = Math.min(g1[1], g2[1]);

            let yIncrement = 0;
            for (const [_, eY] of expansionsY.entries()) {
                if ((minY < eY) && (eY < maxY)) {
                    yIncrement += expansion_factor;
                }
            }
            maxY += yIncrement;

            const xd = maxX - minX;
            const yd = maxY - minY;

            const shortestD = xd + yd;
            sum += shortestD;
            nPairs += 1;
        }
    }
    console.log("\n\nN pairs of galaxies: " + nPairs);
    return sum;
}
console.log("Part 1 grand total: " + calculate((2 - 1)));
console.log("Part 2 grand total: " + calculate((1000000 - 1)));